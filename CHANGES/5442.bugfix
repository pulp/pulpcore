Added a lock to avoid multiple workers sending metrics at the same time.
