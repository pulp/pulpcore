Added transactions around repository version operations to prevent data loss.
