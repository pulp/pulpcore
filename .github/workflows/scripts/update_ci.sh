#!/usr/bin/env bash
# WARNING: DO NOT EDIT!
#
# This file was generated by plugin_template, and is managed by it. Please use
# './plugin-template --github pulpcore' to update this file.
#
# For more info visit https://github.com/pulp/plugin_template

set -eu

if [ ! -f "template_config.yml" ]; then
  echo "No template_config.yml detected."
  exit 1
fi

pip install -r ../plugin_template/test_requirements.txt

pushd ../plugin_template
./plugin-template --github pulpcore
popd

# Check if only gitref file has changed, so no effect on CI workflows.
if [[ $(git diff --name-only) == ".github/template_gitref" ]]; then
  echo "No changes detected in github section."
  git restore ".github/template_gitref"
fi

pushd ../plugin_template
./plugin-template --docs pulpcore
popd

# Check if only gitref file has changed, so no effect on CI workflows.
if [[ $(git diff --name-only) == "docs/template_gitref" ]]; then
  echo "No changes detected in docs section."
  git restore "docs/template_gitref"
fi

if [[ $(git status --porcelain) ]]; then
  git add -A
  git commit -m "Update CI files" -m "[noissue]"
else
  echo "No updates needed"
fi
