from django.db import models

from pulpcore.app.models.base import BaseModel
from pulpcore.app.util import get_domain_pk


class VulnerabilityReport(BaseModel):
    """
    A model for storing vulnerability reports for Content/RepositoryVersion.

    Fields:
        vulns (models.JSONField): A JSON field containing the list of vulnerabilities found
            in osv.dev.

    Relations:
        content (models.OneToOneField): The Content object that was scanned for vulnerabilities.
        pulp_domain (models.ForeignKey): The Domain this vulnerability report belongs to,
            providing multi-tenancy isolation.
        repo_versions (models.ManyToManyField): The RepositoryVersion(s) where the scanned
            Content appears. This allows tracking which repository versions contain
            vulnerable content.
    """

    content = models.OneToOneField(
        "Content",
        on_delete=models.CASCADE,
        unique=True,
    )
    vulns = models.JSONField()
    pulp_domain = models.ForeignKey("Domain", default=get_domain_pk, on_delete=models.CASCADE)
    repo_versions = models.ManyToManyField("RepositoryVersion", blank=True)

    class Meta:
        default_related_name = "%(app_label)s_%(model_name)s"
