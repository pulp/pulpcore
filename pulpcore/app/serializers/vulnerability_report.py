from rest_framework import serializers

from pulpcore.app.models import VulnerabilityReport
from pulpcore.app.serializers import (
    DetailRelatedField,
    IdentityField,
    ModelSerializer,
    RepositoryVersionRelatedField,
)


class VulnerabilityReportSerializer(ModelSerializer):
    """
    A serializer for the VulnerabilityReport Model.
    """

    vulns = serializers.JSONField()
    pulp_href = IdentityField(view_name="vuln_report-detail")
    content = DetailRelatedField(
        read_only=True,
        view_name_pattern=r"content(-.*/.*)-detail",
    )
    repo_versions = RepositoryVersionRelatedField(many=True, required=False)

    class Meta:
        model = VulnerabilityReport
        fields = ModelSerializer.Meta.fields + ("vulns", "repo_versions", "content")
