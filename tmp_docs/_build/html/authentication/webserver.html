<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Webserver &mdash; Pulp Project 3.23.0.dev documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Keycloak" href="keycloak.html" />
    <link rel="prev" title="Basic" href="basic.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Pulp Project
          </a>
              <div class="version">
                3.23.0.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../from-pulp-2.html">Changes From Pulp 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Authentication</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic.html">Basic</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Webserver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#webserver-auth-in-same-webserver">Webserver Auth in Same Webserver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#webserver-auth-with-reverse-proxy">Webserver Auth with Reverse Proxy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="keycloak.html">Keycloak</a></li>
<li class="toctree-l2"><a class="reference internal" href="other.html">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/index.html">Workflows and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_dev/index.html">Plugin Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest_api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client_bindings.html">Client Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugs-features.html">Bugs, Feature and Backport Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_process.html">Pulpcore Release Process</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pulp Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Authentication</a></li>
      <li class="breadcrumb-item active">Webserver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/authentication/webserver.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="webserver">
<span id="webserver-authentication"></span><h1>Webserver<a class="headerlink" href="#webserver" title="Permalink to this heading">¶</a></h1>
<p>Pulp can be configured to use authentication provided in the webserver outside of Pulp. This allows
for integration with ldap for example, through <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_ldap.html">mod_ldap</a>, or certificate based API access, etc.</p>
<p>Enable external authentication in two steps:</p>
<p>1. Accept external auth instead of checking the internal users database by setting the
<code class="docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code> to <code class="docutils literal notranslate"><span class="pre">['django.contrib.auth.backends.RemoteUserBackend']</span></code>. This will
cause Pulp to accept any username for each request and by default create a user in the database
backend for them. To have any name accepted but not create the user in the database backend, use the
<code class="docutils literal notranslate"><span class="pre">pulpcore.app.authentication.PulpNoCreateRemoteUserBackend</span></code> instead.</p>
<p>It is preferable to have users created because the authorization and permissions continue to
function normally since there are users in the Django database to assign permissions to and later
check. When using the <code class="docutils literal notranslate"><span class="pre">pulpcore.app.authentication.PulpNoCreateRemoteUserBackend</span></code> you also should
set the <code class="docutils literal notranslate"><span class="pre">DEFAULT_PERMISSION_CLASSES</span></code> to check permissions differently or not at all. By default
Pulp sets <code class="docutils literal notranslate"><span class="pre">DEFAULT_PERMISSION_CLASSES</span></code> to <code class="docutils literal notranslate"><span class="pre">pulpcore.plugin.access_policy.AccessPolicyFromDB</span></code>
which provides role based permission checking via a user in the database. For example, to only serve
to authenticated users specify set <code class="docutils literal notranslate"><span class="pre">DEFAULT_PERMISSION_CLASSES</span></code> to
<code class="docutils literal notranslate"><span class="pre">rest_framework.permissions.IsAuthenticated</span></code>. Alternatively, to allow any user (even
unauthenticated) use <code class="docutils literal notranslate"><span class="pre">rest_framework.permissions.AllowAny</span></code>.</p>
<ol class="arabic" start="2">
<li><p>Specify how to receive the username from the webserver. Do this by specifying to DRF an
<code class="docutils literal notranslate"><span class="pre">DEFAULT_AUTHENTICATION_CLASSES</span></code>. For example, consider this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span><span class="p">[</span><span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pulpcore.app.authentication.PulpRemoteUserAuthentication&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>This removes <code class="docutils literal notranslate"><span class="pre">rest_framework.authentication.BasicAuthentication</span></code>, but retains
<code class="docutils literal notranslate"><span class="pre">rest_framework.authentication.SessionAuthentication</span></code> and adds
<code class="docutils literal notranslate"><span class="pre">PulpRemoteUserAuthentication</span></code>. This accepts the username as WSGI environment variable
<code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> by default, but can be configured via the
<a class="reference internal" href="../configuration/settings.html#remote-user-environ-name"><span class="std std-ref">REMOTE_USER_ENVIRON_NAME</span></a> Pulp setting.</p>
<section id="webserver-auth-in-same-webserver">
<span id="webserver-authentication-same-webserver"></span><h2>Webserver Auth in Same Webserver<a class="headerlink" href="#webserver-auth-in-same-webserver" title="Permalink to this heading">¶</a></h2>
<p>If your webserver authentication is occurring in the same webserver that is serving the
<code class="docutils literal notranslate"><span class="pre">pulpcore.app.wsgi</span></code> application, you can pass the authenticated username to Pulp via the WSGI
environment variable <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>.</p>
<p>Reading the <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> WSGI environment is the default behavior of the
<code class="docutils literal notranslate"><span class="pre">rest_framework.authentication.RemoteUserAuthentication</span></code> and the Pulp provided
<code class="docutils literal notranslate"><span class="pre">pulpcore.app.authentication.PulpRemoteUserAuthentication</span></code>. The only difference in the Pulp
provided one is that the WSGI environment variable name can be configured.</p>
<p>See the <a class="reference internal" href="../configuration/settings.html#remote-user-environ-name"><span class="std std-ref">REMOTE_USER_ENVIRON_NAME</span></a> for configuring the WSGI provided
name, but if you are using the <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> WSGI environment name with “same webserver”
authentication, you likely want to leave <a class="reference internal" href="../configuration/settings.html#remote-user-environ-name"><span class="std std-ref">REMOTE_USER_ENVIRON_NAME</span></a>
unset and configure the webserver to set the <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> WSGI environment variable.</p>
</section>
<section id="webserver-auth-with-reverse-proxy">
<span id="webserver-authentication-with-reverse-proxy"></span><h2>Webserver Auth with Reverse Proxy<a class="headerlink" href="#webserver-auth-with-reverse-proxy" title="Permalink to this heading">¶</a></h2>
<p>For example purposes, assume you’re using Nginx with LDAP authentication required and after
authenticating it reverse proxies your request to the gunicorn process running the pulpcore.app.wsgi
application. That would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nginx</span> <span class="o">&lt;---</span><span class="n">http</span><span class="o">---&gt;</span> <span class="n">gunicorn</span> <span class="o">&lt;----</span><span class="n">WSGI</span><span class="o">----&gt;</span> <span class="n">pulpcore</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi</span> <span class="n">application</span>
</pre></div>
</div>
<p>With nginx providing authentication, all it can do is pass <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> (or similar name) to the
application webserver, i.e. gunicorn. You can pass the header as part of the proxy request in nginx
with a config line like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>proxy_set_header REMOTE_USER $remote_user;
</pre></div>
</div>
<p>Per the <a class="reference external" href="https://www.python.org/dev/peps/pep-0333/#environ-variables">WSGI standard</a>, any incoming
headers will be prepended with a <code class="docutils literal notranslate"><span class="pre">HTTP_</span></code>. The above line would send the header named
<code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> to gunicorn, and the WSGI application would receive it as <code class="docutils literal notranslate"><span class="pre">HTTP_REMOTE_USER</span></code>. The
default configuration of Pulp is expecting <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> in the WSGI environment not
<code class="docutils literal notranslate"><span class="pre">HTTP_REMOTE_USER</span></code>, so this won’t work with
<code class="docutils literal notranslate"><span class="pre">pulpcore.app.authentication.PulpRemoteUserAuthentication</span></code> or the Django Rest Framework provided
<code class="docutils literal notranslate"><span class="pre">rest_framework.authentication.RemoteUserAuthentication</span></code> as is.</p>
<p>Pulp provides a setting named <a class="reference internal" href="../configuration/settings.html#remote-user-environ-name"><span class="std std-ref">REMOTE_USER_ENVIRON_NAME</span></a> which allows
you to specify another WSGI environment variable to read the authenticated username from.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Configuring this has serious security implications. See the <a class="reference external" href="https://docs.djangoproject.com/en/3.2/howto/auth-remote-user/#configuration">Django warning at the end of this
section in their docs</a> for more details.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="basic.html" class="btn btn-neutral float-left" title="Basic" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="keycloak.html" class="btn btn-neutral float-right" title="Keycloak" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Pulp Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74748547-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
$( document ).ready( function() {

  // gets version number minus whitespace and bugfix version
  var $version_number = $('.version').text().trim().split('.', 2).join('.')

  // div mirroring the admonition-warning generated by sphinx if added to .rst
  var warning = '\
          <div class="admonition warning"> \
              <p class="first admonition-title">Warning</p> \
              <p class="last">You are looking at the docs for an unsupported version of Pulp. \
               Consider switching to a  \
               <a href="https://pulpproject.org/docs/">supported version</a></p> \
          </div>'

  
  // get JSON from server and load supported_versions
  $.getJSON("https://raw.githubusercontent.com/pulp/pulp-ci/master/ci/config/releases/supported-releases.json" , function(data) {
    if ($.inArray($version_number, data) === -1) {
      $('.rst-content').prepend(warning)
      }
    })
  })
  </script>


</body>
</html>